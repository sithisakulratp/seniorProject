<!DOCTYPE>
<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Intersectionality</title>
  <link rel="stylesheet" href="/intersectionality.css">
  <style>
    .sankey {
      width: 2000px;
    }
  </style>
  <script src="/d3.min.js"></script>
  <script src="https://d3js.org/d3.v3.min.js"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <!-- <script src="https://d3js.org/d3.v5.min.js"></script> -->
  <script src="https://d3js.org/d3-selection.v1.js"></script>
  <script src="https://d3js.org/d3-selection-multi.v1.min.js"></script>
  <script src="https://unpkg.com/d3-array@1"></script>
  <script src="https://unpkg.com/d3-collection@1"></script>
  <script src="https://unpkg.com/d3-path@1"></script>
  <script src="https://unpkg.com/d3-shape@1"></script>
  <script src="https://unpkg.com/d3-sankey@0"></script>
</head>

<body>
  <h1 align="center">Intersectionality at Xavier</h1>

  <img class="sankey" src="sankey.svg">
  <script type="text/javascript">
  var sankey = d3.sankey();
  var ageCnt, sexCnt, genderIdentity, sexual_orientation, immigration_status,
      ethnicity, highest_education, marital_status, religion_faith, disability;
  // parsing data from CSV file
  d3.csv("data_q.csv").then(function(data) {
    // regrouping for age
    ageCnt = d3.nest()
        .key(function(d) { return d.Q8; })
        .rollup(function(v) { return v.length; })
        .entries(data)
        .map(function(group) {
          return {
            age: group.key,
            count: group.value
          }
        });
    console.log(ageCnt);

    // regrouping sex assigned at birth
    sexCnt = d3.nest()
        .key(function(d) { return d.Q9; })
        .rollup(function(v) { return v.length; })
        .entries(data)
        .map(function(group) {
          return {
            sex: group.key,
            count: group.value
          }
        });
    console.log(sexCnt);

    // regrouping gender identity
    genderIdentity = d3.nest()
        .key(function(d) { return d.Q10; })
        .rollup(function(v) { return v.length; })
        .entries(data)
        .map(function(group) {
          return {
            gender_identity: group.key,
            count: group.value
          }
        });
    console.log(genderIdentity);

    // regrouping sexual_orientation
    sexual_orientation = d3.nest()
        .key(function(d) { return d.Q11; })
        .rollup(function(v) { return v.length; })
        .entries(data)
        .map(function(group) {
          return {
            sexual_orientation: group.key,
            count: group.value
          }
        });
    console.log(sexual_orientation);

    // regrouping immigration_status
    immigration_status = d3.nest()
        .key(function(d) { return d.Q12; })
        .rollup(function(v) { return v.length; })
        .entries(data)
        .map(function(group) {
          return {
            immigration_status: group.key,
            count: group.value
          }
        });
    console.log(immigration_status);

    // regrouping ethnicity
    ethnicity = d3.nest()
        .key(function(d) { return d.Q13; })
        .rollup(function(v) { return v.length; })
        .entries(data)
        .map(function(group) {
          return {
            ethnicity: group.key,
            count: group.value
          }
        });
    console.log(ethnicity);

    // regrouping highest_education
    highest_education = d3.nest()
        .key(function(d) { return d.Q14; })
        .rollup(function(v) { return v.length; })
        .entries(data)
        .map(function(group) {
          return {
            highest_education: group.key,
            count: group.value
          }
        });
    console.log(highest_education);

    // regrouping marital_status
    marital_status = d3.nest()
        .key(function(d) { return d.Q15; })
        .rollup(function(v) { return v.length; })
        .entries(data)
        .map(function(group) {
          return {
            marital_status: group.key,
            count: group.value
          }
        });
    console.log(marital_status);

    // regrouping religion_faith
    religion_faith = d3.nest()
        .key(function(d) { return d.Q17; })
        .rollup(function(v) { return v.length; })
        .entries(data)
        .map(function(group) {
          return {
            religion_faith: group.key,
            count: group.value
          }
        });
    console.log(religion_faith);

    // regrouping disability
    disability = d3.nest()
        .key(function(d) { return d.Q18; })
        .rollup(function(v) { return v.length; })
        .entries(data)
        .map(function(group) {
          return {
            disability: group.key,
            count: group.value
          }
        });
    console.log(disability);


});
  </script>
</body>
</html>
